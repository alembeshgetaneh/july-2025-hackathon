
{% extends '_header.html' %}
{% block content %}
<link rel="stylesheet" href="/static/style.css">
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3">
            <button class="btn btn-outline-secondary w-100 mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#adminSidebar" aria-expanded="false" aria-controls="adminSidebar">
                <span class="navbar-toggler-icon"></span> Admin Actions
            </button>
            <div class="collapse" id="adminSidebar">
                <div class="list-group mb-4">
                    <form method="POST" action="/admin/reset_queue" onsubmit="return confirm('Are you sure you want to reset the queue?')">
                        <button type="submit" class="list-group-item list-group-item-action">Reset Queue</button>
                    </form>
                    <a href="/admin/add_staff" class="list-group-item list-group-item-action">Add Staff</a>
                    <a href="/admin/update_credentials" class="list-group-item list-group-item-action">Change Admin Credentials</a>
                    <form method="POST" action="/admin/remove_staff" class="mt-2">
                        <div class="input-group">
                            <select name="username" class="form-select">
                                {% for staff in staff_list %}
                                    <option value="{{ staff }}">{{ staff }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-danger">Remove Staff</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Main Content -->
        <div class="col-md-9">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h1 class="mb-0">Admin Dashboard</h1>
                    <span class="fs-5 text-muted">Welcome, <span class="text-primary">Admin</span></span>
                </div>
                <div>
                    <a href="/" class="btn btn-outline-primary me-2">Home</a>
                    <a href="/admin/logout" class="btn btn-outline-danger">Logout</a>
                </div>
            </div>
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card text-center shadow-sm mb-2">
                        <div class="card-body">
                            <h5 class="card-title">Total Citizens Served Today</h5>
                            <p class="display-6">{{ total_citizens_today if total_citizens_today is defined else '0' }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card text-center shadow-sm mb-2">
                        <div class="card-body">
                            <h5 class="card-title">Average Wait Time</h5>
                            <p class="display-6 text-info">{{ average_wait_time if average_wait_time is defined else 'N/A' }} min</p>
                        </div>
                    </div>
                </div>
            </div>
            {% if queue and queue|length > 0 %}
                <div class="alert alert-info text-center mb-4" style="margin-top: 70px;">
                    <strong>Now Serving:</strong>
                    <span class="display-6 text-success">{{ queue[0].name }}</span>
                    <span class="ms-2">({{ queue[0].cert_type }})</span>
                    {% if queue[0].priority == 'priority' %}
                        <span class="badge bg-danger ms-2">Priority</span>
                    {% endif %}
                </div>
            {% else %}
                <div class="alert alert-warning text-center mb-4" style="margin-top: 70px;">
                    <strong>No citizens are currently in the queue.</strong>
                </div>
            {% endif %}
            <div class="card mb-4 shadow-sm">
                <div class="card-header"><h4 class="mb-0">Current Queue</h4></div>
                <div class="card-body p-0">
                    {% if queue and queue|length > 0 %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped mb-0">
                            <thead class="table-light">
                                <tr><th>Name</th><th>Type</th><th>Priority</th></tr>
                            </thead>
                            <tbody>
                            {% for person in queue %}
                                <tr>
                                    <td>{{ person.name }}</td>
                                    <td>{{ person.cert_type }}</td>
                                    <td>{% if person.priority == 'priority' %}<span class="badge bg-danger">Priority</span>{% else %}<span class="badge bg-secondary">Normal</span>{% endif %}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                        <div class="p-4 text-center text-muted">No citizens are currently in the queue.</div>
                    {% endif %}
                </div>
            </div>
            <div class="card mb-4 shadow-sm">
                <div class="card-header"><h4 class="mb-0">Recent Service Logs</h4></div>
                <div class="card-body p-0">
                    <a href="/admin/export_logs" class="btn btn-outline-primary m-3">Download Service Logs (CSV)</a>
                    {% if logs and logs|length > 0 %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped mb-0" aria-label="Current Queue">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Type</th>
                                    <th scope="col">Priority</th>
                                    <th scope="col">Served At</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for log in logs %}
                                <tr>
                                    <td><strong>{{ log.name }}</strong></td>
                                    <td>{{ log.cert_type }}</td>
                                    <td>{% if log.priority == 'priority' %}<span class="badge bg-danger" aria-label="Priority">Priority</span>{% else %}<span class="badge bg-secondary" aria-label="Normal">Normal</span>{% endif %}</td>
                                    <td>{{ log.served_at }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                        <div class="p-4 text-center text-muted">No service logs available yet.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% include '_footer.html' %}
<script>
// Ensure sidebar hamburger toggles content
document.addEventListener('DOMContentLoaded', function() {
    var sidebarBtn = document.querySelector('[data-bs-target="#adminSidebar"]');
    var sidebar = document.getElementById('adminSidebar');
    if (sidebarBtn && sidebar) {
        sidebarBtn.addEventListener('click', function() {
            sidebar.classList.toggle('show');
        });
    }
});
</script>
